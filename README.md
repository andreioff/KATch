# Artifact for "A Fast Symbolic Verifier for NetKAT"

*NetKAT* is a regular-expression-like language for specifying the trace behavior of networks. Network verification queries can be expressed as equivalence or containment queries between NetKAT policies. We present *KATch*, which implements a DSL for for NetKAT verification queries called *NKPL* (NetKAT programming language).

The following NKPL script verifies the equivalence of two NetKAT policies:
```
-- Define two simple NetKAT policies
net1 = (((@a←1 ⋅ @b←2 ⋅ @c←3 ⋅ δ)⋆) + ((@b=2 ⋅ @c=3 ⋅ δ)⋆))⋆
net2 = (((@b=2 ⋅ @c=3 ⋅ δ)⋆) + ((@a←1 ⋅ @b←2 ⋅ @c←3 ⋅ δ)⋆))⋆

-- Verify that net1 is equivalent to net2
check net1 ≡ net2

-- Visualise the policy in the given output directory
graphviz "out/net1" net1
```
A tutorial for NKPL is available in the `nkpl/tutorial.nkpl` file.

## Quick start guide

You can install and run KATch using Docker:

1. Install [Docker](https://www.docker.com/get-started/).
2. Run `docker run -it julesjacobs/katch:latest -v ./results:/katch/results` on your command line. You are now inside the KATch Docker image.
3. Run `./katch run nkpl/tutorial.nkpl` to run KATch on the tutorial NKPL file.
4. You can view the resulting graphviz visualisation and running time in your local `results` directory.

## Evaluation instructions

To evaluate this artifact, you can follow these steps:

### 1. Learn about NKPL

Read the `tutorial.nkpl` file to learn about the NKPL language and how to write NKPL programs.

### 2. Write your own NKPL programs

Write your own NKPL programs to verify NetKAT policies. You can use the `tutorial.nkpl` file as a starting point.


### 3. Run the tests

Run the tests in the `nkpl/tests` directory to verify the correctness of KATch. You can use the following command to run all `.nkpl` files in the `nkpl/tests` directory:

```
./katch run nkpl/tests
```

 (These include 500,000 tests generated by fuzzing; takes ~15min)

### 4. Reproduce Benchmarks from the Paper

We have provided several additional scripts to run all of the experiments in the paper and generate the associated graphs, including comparisons with [Frenetic](https://github.com/frenetic-lang/frenetic). The estimates for running time are on a machine running Ubuntu 22.04 with a 2.1GHz Xeon Silver 4216 CPU and 500G RAM. The scripts are:

- `scripts/paper-exper.sh`: Runs all of the experiments from the paper and generates Figure 9, Figure 10, and Figure 11. This takes between 1-2 days.
- `scripts/abridged.sh`: Runs all of the experiments from the paper, *except* the Cogentco benchmarks from Figure 11, and a 1 minute timeout is used for Figure 9. This takes 10 hours.
- `scripts/katch-only.sh`: Runs all of the experiments from the paper with no timeouts, but only runs KATch (not Frenetic). This takes 1.5 hours.

### 5. Analyse the results

Analyse the results of the benchmarks in the `results` directory to evaluate the performance of KATch.

## File structure

This artifact contains the source code for KATch, as well as a suite of benchmarks and scripts for running the benchmarks. You can also find the entire source code (and Dockerfile) [on GitHub](https://github.com/julesjacobs/KATch/tree/master).
This artifact is organised as follows:

- `src/main/scala`: Source code for KATch 
  - `Main.scala`: Main entry point for KATch
  - `Runner.scala`: Implementation of the runner for NKPL
  - `NK.scala`: Implementation of the NetKAT AST
  - `Parser.scala`: Implementation of the parser for NKPL
  - `SPP.scala`: Implementation of the symbolic policy representation
  - `Bisim.scala`: Implementation of the bisimulation algorithm
  - `Options.scala`: Configuration options for KATch
  - `Viz.scala`: Implementation of the visualisation tool for NetKAT policies
  - `BenchGen.worksheet.sc`: Implementation of the benchmark generator
  - `Fuzzer.worksheet.sc`: Implementation of the fuzzer for SPs and SPPs
- `nkpl`: NKPL files
  - `tutorial.nkpl`: Tutorial for NKPL
  - `tests`: Test cases for NKPL
  - `fig09`: Benchmarks for Figure 9
  - `fig10`: Benchmarks for Figure 10
  - `fig10-less-cogentco`: Benchmarks for Figure 10, excluding Cogentco (the largest benchmark)
  - `fig11`: Benchmarks for Figure 11
- `results`: Results of the benchmarks and graphviz visualisations
- `scripts`: Various scripts to aid in running KATch and comparing to Frenetic
- `Dockerfile`: The Dockerfile can be used to build the Docker image for KATch
